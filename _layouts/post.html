<!DOCTYPE HTML>
<html lang="en" >
    <head>

        {%- include head.html -%}

        {% if page.previous %}
            <link rel="prev" href="{{site.baseurl}}{{page.previous.url}}" />
        {% else %}
            <link rel="prev" href="{{site.baseurl}}/" />
        {% endif %}

        {% if page.next %}
            <link rel="next" href="{{site.baseurl}}{{page.next.url}}" />
        {% endif %}
    </head>
    <body>
        
        <div class="book">

            {%- include toc-date.html -%}

            <div class="book-body">
                <div class="book-header" role="navigation">
                    <!-- Title -->
                    <h1>
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                    </h1>
                </div>

                <div class="body-inner">
                    {%- include body.html -%}

                    {% if page.previous %}
                        <a href="{{site.baseurl}}{{page.previous.url}}" class="navigation navigation-prev navigation-unique" aria-label="Previous page: {{page.previous.title}}">
                            <i class="fa fa-angle-left"></i>
                        </a>
                    {% else %}
                        <a href="{{site.baseurl}}/" class="navigation navigation-prev navigation-unique" aria-label="Previous page: {{site.title}}">
                            <i class="fa fa-angle-left"></i>
                        </a>
                    {% endif %}

                    {% if page.next %}
                        <a href="{{site.baseurl}}{{page.next.url}}" class="navigation navigation-next navigation-unique" aria-label="Next page: {{page.next.title}}">
                            <i class="fa fa-angle-right"></i>
                        </a>
                    {% endif %}
                </div>
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({%- include metadata-post.json.tpl -%});
            });
            </script>
        </div>

        {%- include footer.html -%}


        <!-- Image Modal (Zoom) -->
        <div id="imgModal" class="img-modal">
            <span class="img-close">&times;</span>
            <img class="img-modal-content" id="imgPreview">
            <div id="imgCaption"></div>
        </div>

        <style>
        .img-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            padding-top: 60px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.9);
        }
        .img-modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 800px;
            border-radius: 10px;
            animation: zoomIn 0.3s;
        }
        @keyframes zoomIn {
            from {transform: scale(0.7); opacity: 0;}
            to {transform: scale(1); opacity: 1;}
        }
        #imgCaption {
            text-align: center;
            color: #ccc;
            padding: 10px;
        }
        .img-close {
            position: absolute;
            top: 20px;
            right: 35px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }
        .img-close:hover {
        color: #bbb;  
        }
        </style>

        <script>
        (function() {
            const modal = document.getElementById("imgModal");
            const modalImg = document.getElementById("imgPreview");
            const captionText = document.getElementById("imgCaption");
            const closeBtn = document.getElementsByClassName("img-close")[0];

            function openModalForImage(img) {
                if (!img) return;
                modal.style.display = "block";
                modalImg.src = img.src;
                captionText.textContent = img.alt || "";
            }

            // Delegated click handler: buka modal jika yang diklik <img> di dalam .book-body atau .page-inner
            document.addEventListener("click", function(event) {
                const el = event.target;
                if (el && el.tagName === "IMG" && (el.closest(".book-body") || el.closest(".page-inner"))) {
                    // set cursor hint (opsional)
                    el.style.cursor = "zoom-in";
                    openModalForImage(el);
                }
            });

            // Tutup tombol
            if (closeBtn) {
                closeBtn.addEventListener("click", function() {
                    modal.style.display = "none";
                });
            }

            // Tutup bila klik di luar gambar (pada backdrop)
            if (modal) {
                modal.addEventListener("click", function(event) {
                    if (event.target === modal) {
                        modal.style.display = "none";
                    }
                });
            }

            // Tutup dengan tombol Escape
            document.addEventListener("keydown", function(ev) {
                if (ev.key === "Escape" && modal && modal.style.display === "block") {
                    modal.style.display = "none";
                }
            });

            // Tidak perlu re-inisialisasi pada page.change karena delegation menangani elemen baru.
        })();
        </script>

    </body>
</html>